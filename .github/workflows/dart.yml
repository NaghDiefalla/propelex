# This workflow uses actions that are not certified by GitHub.
# They are provided by a third-party and are governed by
# separate terms of service, privacy policy, and support
# documentation.

name: Flutter Build

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      # 1. Use the Flutter setup action instead of the Dart one.
      - name: Set up Flutter SDK
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.22.0' # Adjust to your required version
          channel: 'stable'
      
      # 2. Use 'flutter pub get' for a Flutter project.
      - name: Install dependencies
        run: flutter pub get

      # 3. Use 'flutter analyze'
      - name: Analyze project source
        run: flutter analyze

      # 4. Use 'flutter test'
      - name: Run tests
        run: flutter test
      # --- END OF FIXES ---

      # 4. Build the Release APK
      - name: Build Android APK
        run: flutter build apk --release

      # 5. Find the APK and upload it as a workflow artifact
      - name: Upload APK Artifact
        uses: actions/upload-artifact@v4
        with:
          name: app-release-apk
          path: build/app/outputs/flutter-apk/app-release.apk 